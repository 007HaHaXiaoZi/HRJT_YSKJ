(window.webpackJsonp=window.webpackJsonp||[]).push([[2119],{3407:function(t,a,s){"use strict";s.r(a);var r=s(1),e=Object(r.a)({},(function(){var t=this.$createElement;this._self._c;return this._m(0)}),[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"相机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相机"}},[t._v("#")]),t._v(" 相机")]),t._v(" "),s("p",[t._v("相机"),s("a",{attrs:{href:"/miniprogram/dev/api/xr-frame/classes/Camera"}},[t._v("Camera")]),t._v("是渲染系统最核心的组件之一，和几乎所有的渲染引擎一样，它真正驱动着整个渲染管线的运作。相机组件一般被代理到相机元素"),s("a",{attrs:{href:"/miniprogram/dev/api/xr-frame/classes/XRCamera"}},[t._v("XRCamera")]),t._v("中使用，其派生自"),s("a",{attrs:{href:"./../core/node.html"}},[t._v("XRNode")]),t._v("，对应在"),s("code",[t._v("xml")]),t._v("中的标签为"),s("code",[t._v("xr-camera")]),t._v("。")]),t._v(" "),s("p",[t._v("相机组件也承载了一部分"),s("a",{attrs:{href:"./../ar/"}},[t._v("AR系统")]),t._v("相关的能力，同时我们还提供了配套的相机控制器组件"),s("a",{attrs:{href:"/miniprogram/dev/api/xr-frame/classes/CameraOrbitControl"}},[t._v("CameraOrbitControl")]),t._v("来方便开发者进行相机控制。")]),t._v(" "),s("h2",{attrs:{id:"相机元素"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相机元素"}},[t._v("#")]),t._v(" 相机元素")]),t._v(" "),s("p",[t._v("相机元素的一个典型使用方式如下：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("xr-node")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("node-id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("position")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1 1 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("xr-camera")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("position")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0 1 4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("clear-color")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0.4 0.6 0.7 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("background")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("skybox"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("target")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("camera-orbit-control")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),s("p",[t._v("这里面只列出了部分属性，实际上属性要多得多，下面就给大家一一举例。")]),t._v(" "),s("blockquote",[s("p",[s("span",{staticStyle:{color:"red"}},[t._v("以下属性均已"),s("strong",[t._v("组件数据驼峰命名")]),t._v("给出，在元素中按照框架约定均转成**小写加"),s("code",[t._v("-")]),t._v("**的形式。")])])]),t._v(" "),s("h3",{attrs:{id:"投影方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#投影方式"}},[t._v("#")]),t._v(" 投影方式")]),t._v(" "),s("p",[t._v("首先是投影方式以及其相关的参数，投影方式由"),s("code",[t._v("isPerspective")]),t._v("决定，声明是否使用透视投影，目前默认即为透视投影，关于这两者的区分开发者可以自行查阅。")]),t._v(" "),s("p",[t._v("无论是对于哪种投影类型，以下参数都是通用的：")]),t._v(" "),s("ol",[s("li",[t._v("near：近裁剪平面，决定相机最近能看到多远的物体。")]),t._v(" "),s("li",[t._v("far：远裁剪平面，决定相机最远能看到多远的物体。")])]),t._v(" "),s("p",[t._v("在选择了透视投影的模式下，有以下参数可供调整：")]),t._v(" "),s("ol",[s("li",[t._v("fov：视场角，角度，默认为60。")])]),t._v(" "),s("p",[t._v("在选择了正交投影的情况下则有以下参数：")]),t._v(" "),s("ol",[s("li",[t._v("orthSize：相机可视范围大小，是"),s("strong",[t._v("横向")]),t._v("的尺寸，纵向会根据"),s("code",[t._v("aspect")]),t._v("换算。")])]),t._v(" "),s("h4",{attrs:{id:"自定义矩阵"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义矩阵"}},[t._v("#")]),t._v(" 自定义矩阵")]),t._v(" "),s("p",[t._v("本质上来讲，投影方式和参数方式决定了投影矩阵，而相机所在元素挂载的"),s("code",[t._v("transform")]),t._v("组件则决定了视图矩阵，这里不再赘述这种基本概念，一般来讲都是框架自动计算的。但在某些高级需求，比如水面折射投影的渲染需求中，确实有可能要自己定制投影方式、甚至是定制视图矩阵的计算。为了解决这种需求，框架提供了方案。")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 修改投影矩阵")]),t._v("\ncamera"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("changeProjectMatrix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("manual"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" matrix"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 修改视图矩阵")]),t._v("\ncamera"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("changeViewMatrix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("manual"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" matrix"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这两个方法可以用于修改投影或者视图矩阵，第一个参数"),s("code",[t._v("manual")]),t._v("用于控制开启或者关闭手动模式，第二个参数即为要设置的矩阵值。")]),t._v(" "),s("h3",{attrs:{id:"渲染目标和视图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#渲染目标和视图"}},[t._v("#")]),t._v(" 渲染目标和视图")]),t._v(" "),s("p",[t._v("知道了要花那些物体、以及如何讲这些物体投影到平面上，还需要知道将这些东西最终画在什么上面，这就是"),s("strong",[t._v("渲染目标")]),s("code",[t._v("renderTarget")]),t._v("。")]),t._v(" "),s("p",[s("code",[t._v("renderTarget")]),t._v("可选值为空或者"),s("a",{attrs:{href:"./render-texture.html"}},[t._v("渲染纹理")]),t._v("资源，如果为空则会渲染到主屏上，渲染纹理详见对应的章节。")]),t._v(" "),s("p",[t._v("在渲染目标渲染前，我们需要先视情况将其清空，这主要由几个参数决定：")]),t._v(" "),s("ol",[s("li",[t._v("isClearColor/clearColor：设置是否要在绘制前清除渲染目标的颜色，以及要清除为怎样的颜色。")]),t._v(" "),s("li",[t._v("isClearDepth/clearDepth：设置是否要在绘制前清除渲染目标的深度，以及要清除为怎样的深度。")]),t._v(" "),s("li",[t._v("isClearStencil/clearStencil：设置是否要在绘制前清除渲染目标的模板值，以及要清除为怎样的模板值。")])]),t._v(" "),s("h3",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),s("p",[t._v("在清屏后我们可能需要为整个场景绘制一个背景，这时候便可以使用"),s("code",[t._v("background")]),t._v("数据，其可选以下几种类型：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("default")]),t._v("：默认行为，只清屏，不绘制背景。")]),t._v(" "),s("li",[s("code",[t._v("skybox")]),t._v("：绘制天空盒，依赖于环境数据"),s("a",{attrs:{href:"./env.html"}},[t._v("Env")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("ar")]),t._v("：当开启了AR系统后，将会绘制设备摄像头的内容，详见"),s("a",{attrs:{href:"#ar%E7%9B%B8%E5%85%B3"}},[t._v("AR相关")]),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"跟随目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跟随目标"}},[t._v("#")]),t._v(" 跟随目标")]),t._v(" "),s("p",[t._v("框架默认集成了基本的了相机跟随控制能力，只需要设置"),s("code",[t._v("target")]),t._v("即可，在"),s("code",[t._v("xml")]),t._v("中这是一个节点的"),s("code",[t._v("node-id")]),t._v("，本质上就是一个"),s("code",[t._v("transform")]),t._v("组件。")]),t._v(" "),s("p",[t._v("指定了它之后，相机在移动时，的前向将始终朝向"),s("code",[t._v("target")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"深度和掩码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#深度和掩码"}},[t._v("#")]),t._v(" 深度和掩码")]),t._v(" "),s("p",[t._v("除了通过平截体剔除确定哪些物体要被渲染之外，还需要一种直接精确的剔除方案，这就是"),s("strong",[t._v("掩码（cullMask）")]),t._v("。这个实际上已经在"),s("a",{attrs:{href:"./../core/node.html#可见性与图层"}},[t._v("可见性与图层")]),t._v("中论述过。")]),t._v(" "),s("p",[t._v("除了单相机的渲染，很多时候会有很多个相机，它们之间也可能会有一定的顺序，这时候就可以使用"),s("code",[t._v("depth")]),t._v("来调整这个顺序，越大渲染顺序越靠后。在同一"),s("code",[t._v("depth")]),t._v("下，以标签编写的前后顺序为准。")]),t._v(" "),s("h3",{attrs:{id:"AR相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#AR相关"}},[t._v("#")]),t._v(" AR相关")]),t._v(" "),s("p",[t._v("在开启了"),s("a",{attrs:{href:"./../ar/"}},[t._v("AR系统")]),t._v("后，相机便可以使用AR相关的能力。")]),t._v(" "),s("p",[t._v("其一就是"),s("code",[t._v("background")]),t._v("指定为"),s("code",[t._v("ar")]),t._v("后，场景背景会绘制当前设备摄像机的画面。")]),t._v(" "),s("p",[t._v("第二是"),s("code",[t._v("isARCamera")]),t._v("数据，将其开启后在某些AR系统的模式下将会自动设置视图和透视矩阵，来匹配现实中设备摄像机的位置和视角。")]),t._v(" "),s("blockquote",[s("p",[s("span",{staticStyle:{color:"red"}},[t._v("非常需要注意，当开启"),s("code",[t._v("isARCamera")]),t._v("并且AR系统为"),s("code",[t._v("Plane")]),t._v("或者"),s("code",[t._v("Marker")]),t._v("模式时，"),s("strong",[t._v("不能同时设置"),s("code",[t._v("target")]),t._v("数据")]),t._v("！！！")])])]),t._v(" "),s("h3",{attrs:{id:"后处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后处理"}},[t._v("#")]),t._v(" 后处理")]),t._v(" "),s("p",[t._v("数据"),s("code",[t._v("postProcess")]),t._v("用于指定相机需要用到的后处理资源数组，详见"),s("a",{attrs:{href:"./post-process.html"}},[t._v("后处理")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"相机控制器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相机控制器"}},[t._v("#")]),t._v(" 相机控制器")]),t._v(" "),s("p",[t._v("相机控制器组件提供了一个简单的绕着相机"),s("code",[t._v("target")]),t._v("旋转的控制方式，一般而言只需要在元素上添加"),s("code",[t._v("camera-orbit-control")]),t._v("属性即可。当然相机控制器也提供了丰富的配置参数，如果想要调节可见API文档"),s("a",{attrs:{href:"/miniprogram/dev/api/xr-frame/classes/CameraOrbitControl"}},[t._v("CameraOrbitControl")]),t._v("。")])])}],!1,null,null,null);a.default=e.exports}}]);